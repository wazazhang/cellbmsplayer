<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml" verticalCenter="0" 
		   horizontalCenter="0" width="300" height="172" borderStyle="solid"
		   cornerRadius="5" backgroundColor="#2D2D2D" backgroundAlpha="0.4"
		   creationComplete="init()" >
		<mx:Script>
			<![CDATA[
				import Class.Server;
				
				import com.fc.lami.Messages.RoomData;
				public var rooms:Array;
				
				
				public var linkTimer:Timer = new Timer(200,25);
				
				public function init():void
				{
					linkTimer.addEventListener(TimerEvent.TIMER_COMPLETE, linkFilad);
					linkTimer.addEventListener(TimerEvent.TIMER, linking)
				}
				
				public function linkServer():void
				{
					bt.enabled = false;
					TIname.enabled = false;
					lb2.visible = true;
					Server.login_cpt = this;
					Server.linkToServer(TIname.text);
					
					linkTimer.reset();
					linkTimer.start();
				}
				
				
				public function linking(event:TimerEvent):void
				{
					switch( linkTimer.currentCount%3)
					{
						case 0 :lb2.text = "连接中.";break;
						case 1 :lb2.text = "连接中..";break;
						case 2 :lb2.text = "连接中...";break;
					}
				}
				
				
				public function linkFilad(event:TimerEvent):void
				{
					lb2.text = "连接超时..."
				}
				
				public function linkSunccess():void
				{
					linkTimer.stop();
					lb.text = "登陆成功!请选择一个房间:"
					list.dataProvider = rooms;
					
					login.visible = false;
					selectRoom.visible = true;
				}
				
				public function enterRoom():void
				{
					Server.enterRoom((list.selectedItem as RoomData).room_id)
						
				}
				
				
				public function addRoom():void
				{
					
				}
				
				
				public function disLink():void
				{
					selectRoom.visible = false;
					login.visible = true;
					bt.enabled = true;
					TIname.enabled = true;
					lb2.visible = true;
					lb2.text="与服务器断开连接...";
				}
				
			]]>
		</mx:Script>
	
		<mx:Canvas id="login" width="100%" height="100%">
			<mx:Button id="bt" label="登入" horizontalCenter="94" verticalCenter="0" fontSize="12" click="linkServer()"/>
			<mx:TextInput id="TIname" x="49" fontSize="16" verticalCenter="0"/>
			<mx:Button id="bt2" x="123" y="93" label="进入" visible="false" click="enterRoom()"/>
			<mx:Label y="107" id="lb2" text="" x="96"/>
		</mx:Canvas>
			
		<mx:Canvas id="selectRoom" width="100%" height="100%" visible="false">	
			<mx:Label id="lb" text="waiting..." horizontalCenter="0" y="11" visible="true"></mx:Label>
			<mx:List id="list" height="126" width="200" verticalCenter="12" labelField="room_id" horizontalCenter="0" doubleClickEnabled="true" doubleClick="enterRoom()" ></mx:List>
		</mx:Canvas>
	
</mx:Canvas>
