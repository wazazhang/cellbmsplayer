<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml" verticalCenter="0" 
		   horizontalCenter="0" width="639" height="480" borderStyle="solid"
		   cornerRadius="5" backgroundColor="#2D2D2D" backgroundAlpha="0.4"
		   creationComplete="init()" >
		<mx:Script>
			<![CDATA[
				import Class.Server;
				
				import com.fc.lami.Messages.RoomSnapShot;
				
				import mx.controls.Alert;
				
				[Bindable]
				public var rooms:Array;
				
				
				public var linkTimer:Timer = new Timer(200,300);
				
				public function init():void
				{
					linkTimer.addEventListener(TimerEvent.TIMER_COMPLETE, linkFilad);
					linkTimer.addEventListener(TimerEvent.TIMER, linking)
				}
				
				public function linkServer():void
				{
					if (TIname.text.length <= 0) {
						Alert.show("用户名不能为空");
					}
					
					bt.enabled = false;
					TIname.enabled = false;
					lb2.visible = true;
					Server.login_cpt = this;
					Server.linkToServer(TIname.text, server_host.text, server_port.value);
					linkTimer.reset();
					linkTimer.start();
					
				}
				
				
				public function linking(event:TimerEvent):void
				{
					switch( linkTimer.currentCount%3)
					{
						case 0 :lb2.text = "连接中.";break;
						case 1 :lb2.text = "连接中..";break;
						case 2 :lb2.text = "连接中...";break;
					}
				}
				
				
				public function linkFilad(event:TimerEvent):void
				{
					if (!Server.getClient().isConnected()) 
					{
						lb2.text = "连接超时..."
						Alert.show("连接超时");
						bt.enabled = true;
						TIname.enabled = true;
					}
				}
				
				public function linkSunccess():void
				{
					linkTimer.stop();
					lb.text = "登陆成功!请选择一个房间:"
					
					login.visible = false;
					selectRoom.visible = true;
					
					bt.enabled = true;
					TIname.enabled = true;
				}
				
				public function enterRoom():void
				{
					
					if(list.selectedItem!=null)
					Server.enterRoom((list.selectedItem as RoomSnapShot).room_id)
						
				}
				
				
				public function addRoom():void
				{
					
				}
				
				
				public function disLink():void
				{
					selectRoom.visible = false;
					login.visible = true;
					bt.enabled = true;
					TIname.enabled = true;
					lb2.visible = true;
					lb2.text="与服务器断开连接...";
				}
				
				public function player_numberLF(item:Object,column:DataGridColumn):String
				{
					return item.player_number+'/' +item.player_number_max;
				}
				
				public function levelLF(item:Object,column:DataGridColumn):String
				{
					return "20";
				}
				
				public function modeLF(item:Object,column:DataGridColumn):String
				{
					return "dollar";
				}
				
				
				public function fastEnter():void
				{
					Server.sendAutoEnter();
				}
			]]>
		</mx:Script>
	
		<mx:Canvas id="login" width="100%" height="100%" x="0" y="0">
			<mx:Button id="bt" label="开始" fontSize="20" click="linkServer()" x="240" y="353" width="138" height="47"/>
			<mx:TextInput id="TIname" x="227" fontSize="16" y="217"/>
			<mx:Button id="bt2" x="123" y="93" label="进入" visible="false" click="enterRoom()"/>
			<!--
			<mx:TextInput x="47" y="52" width="160" text="115.236.18.104" id="server_host"/>
			-->
			<mx:TextInput x="227" y="153" width="160" text="127.0.0.1" id="server_host"/>
			<mx:NumericStepper x="227" y="185" width="160" minimum="0" maximum="100000000" value="19821" id="server_port"/>
			<mx:Label x="190" y="155" text="IP"/>
			<mx:Label x="190" y="187" text="端口"/>
			<mx:TextArea x="10" y="10" width="257" height="38" text="此界面为测试界面&#xa;服务器ID和通行证帐号需要和第三方对接" editable="false" cornerRadius="0" borderColor="#646566" borderThickness="0" borderStyle="none" backgroundAlpha="0.0" alpha="1.0"/>
			<mx:Label y="321" id="lb2" x="227" width="160" height="24" enabled="true"/>
			<mx:Label x="467" y="448" text="ver 0.9" width="160"/>
			<mx:Image x="292.5" y="73" source="image/head.png"/>
			<mx:Label x="190" y="222" text="ID"/>
			<mx:Label x="190" y="258" text="密码"/>
			<mx:TextInput x="227" y="253" fontSize="16" displayAsPassword="true"/>
			<mx:LinkButton x="395" y="220" label="注册账号"/>
			<mx:LinkButton x="395" y="256" label="忘记密码"/>
			<mx:CheckBox x="190" y="286" label="保存账号"/>
			<mx:CheckBox x="292" y="286" label="记住密码"/>
			<mx:Label x="395" y="288" text="请不要在公用电脑上保存密码"/>
		</mx:Canvas>
			
		<mx:Canvas id="selectRoom" width="100%" height="100%" visible="false">	
			<mx:Label id="lb" text="waiting..." horizontalCenter="118" y="11" visible="true"></mx:Label>
			
			<mx:DataGrid id="list" width="400" height="372" doubleClickEnabled="true" doubleClick="enterRoom()" x="227" y="39" dataProvider="{rooms}">
				<mx:columns>
					<mx:DataGridColumn headerText="房间名称" dataField="room_name" width="140"/>
					<mx:DataGridColumn headerText="当前人数" labelFunction="player_numberLF"/>
					<mx:DataGridColumn headerText="等级限制" labelFunction="levelLF"/>
					<mx:DataGridColumn headerText="模式" labelFunction="modeLF"/>
				</mx:columns>
			</mx:DataGrid>
			<mx:Button x="227" y="419" label="快速开始" width="400" height="49" click="fastEnter()"/>
			<mx:Canvas x="19" y="10" width="200" height="458" borderStyle="solid" borderColor="#000000">
			</mx:Canvas>
			<!--
			<mx:List id="list2" height="126" width="200" verticalCenter="12" labelField="room_name" horizontalCenter="0" doubleClickEnabled="true" doubleClick="enterRoom()"></mx:List>
			-->
		</mx:Canvas>
	
</mx:Canvas>
